## 1 简介

TCP（传输控制协议）和UDP（用户数据包协议）都是属于传输层协议，传输层的主要任务就是建立应用程序间的端到端连接，并且为数据传输提供可靠或不可靠的通信服务。TCP是面向连接的可靠的传输层协议，它支持在不可靠网络上实现面向连接的可靠的数据传输 ，UDP是无连接的传输协议，主要用于在相对可靠的网络上的数据传输，或用于需要低延时的应用等。
在游戏开发中，一般会根据游戏类型和具体场景选择是使用tcp还是udp。

## IP
IP代表“Internet Protocol”。在IP协议里面没有连接的概念，数据包只是从一台计算机传递到下一台计算机，也无法保证数据被正确送到，除非对方回应。

## TCP

TCP代表“Transmission Control Protocol”。TCP是一种可靠的基于连接的协议。在传输数据之前会两台计算机之间创建了一个连接，然后您就像在一侧写入文件一样交换数据，而在另一侧读取文件。
   
TCP连接可靠且有序。我们发送的所有数据都保证按照编写的顺序到达另一侧。它也是一个流协议，因此TCP会自动将传输的数据拆分成数据包并通过网络进行发送。


## UDP
UDP代表“用户数据报协议”，它是建立在IP之上的另一种协议，但与TCP不同，UDP不是增加许多功能和复杂性，而只是对IP层的一个简单包装。
使用UDP，我们可以将数据包发送到目标IP地址和端口。

与IP一样，UDP是一种不可靠的协议。也无法保证数据的有序到达。

## TCP与UDP

TCP：
- 基于连接
- 保证可靠和有序
- 自动将数据分解为数据包
- 拥塞控制
- 易于使用，您只需读取和写入文件等数据

UDP：
- 没有连接的概念，你必须自己编写代码
- 不保证数据包的可靠性，它们可能无法到达，被复制或根本无法到达
- 必须手动将数据分解为数据包并发送它们
- 没有拥塞控制，必须确保不要太快地发送数据
- 如果数据包丢失，您需要设计一些方法来进行校验，并在必要时重新发送该数据


## TCP工作原理
TCP和UDP都建立在IP之上，但它们完全不同。UDP与其下面的IP协议非常相似，只是对IP协议进行了简单的包装。而TCP则隐藏数据包的复杂性和不可靠性，看起来就像是读取和写入文件一样简单。

首先，TCP是一种面向流的协议，因此只需将字节写入流，TCP确保它们可以传递到另一端。由于IP建立在数据包上，而TCP建立在IP之上，因此TCP必须将数据流分解为数据包。因此，一些内部TCP会对您发送的数据进行排队，然后当有足够的数据待处理队列时，它会将数据包发送到另一台计算机。

如果发送非常小的数据包，比如在多人游戏中，需要传输大量小的数据包。这种情况TCP可能不会立即发送数据，而是直到已经缓冲了足够的数据来打包成一个合理大小的数据包通过网络发送。

所以这就会存在一个问题，当我们需要数据进行实时交互，低延时进行发送和接收。如果被缓冲起来等待聚集成一个小包再进行发送，就会导致体验很差，这就是tcp的粘包。

TCP有一个方法来禁止这种行为，被称为TCP_NODELAY。这个会让TCP不要等待直到有足够的数据排队，而是立即刷新需要写入的任何数据。这被称为禁用Nagle算法。

但是其实即使设置了这个选项，TCP仍然不能解决多人游戏中高延时的问题，这一切都源于TCP处理丢失和无序数据包的方式，需要保证数据的有序和完整。

## TCP如何实现可靠性

TCP将数据流分解为数据包，通过不可靠的IP发送这些数据包，然后获取另一端收到的数据包并重建流。

